<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Productos</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}
		body {
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			background: #000000;
			min-height: 100vh;
			padding: 20px;
		}
		.container {
			max-width: 1400px;
			margin: 0 auto;
			background: white;
			border-radius: 10px;
			box-shadow: 0 10px 30px rgba(0,0,0,0.3);
			padding: 30px;
		}
		h1 {
			color: #333;
			margin-bottom: 30px;
			text-align: center;
			font-size: 2.5em;
		}
		.nav {
			margin-bottom: 30px;
			text-align: center;
		}
		.nav a {
			display: inline-block;
			padding: 10px 20px;
			background: #000000;
			color: white;
			text-decoration: none;
			border-radius: 5px;
			border: 2px solid white;
			margin: 0 10px;
			transition: background 0.3s;
		}
		.nav a:hover {
			background: white;
			color: black;
		}
		.filters {
			background: #f9f9f9;
			padding: 20px;
			border-radius: 8px;
			margin-bottom: 30px;
			display: flex;
			gap: 15px;
			flex-wrap: wrap;
			align-items: end;
		}
		.filter-group {
			flex: 1;
			min-width: 150px;
		}
		.filter-group label {
			display: block;
			margin-bottom: 5px;
			color: #555;
			font-weight: 500;
		}
		.filter-group input,
		.filter-group select {
			width: 100%;
			padding: 10px;
			border: 1px solid #ddd;
			border-radius: 5px;
			font-size: 1em;
		}
		.btn {
			padding: 10px 20px;
			border: none;
			border-radius: 5px;
			cursor: pointer;
			font-size: 1em;
			transition: background 0.3s;
		}
		.btn-primary {
			background: #000000;
			color: white;
			border: 2px solid white;
		}
		.btn-primary:hover {
			background: white;
			color: black;
		}
		.products-grid {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
			gap: 20px;
			margin-bottom: 30px;
		}
		.product-card {
			border: 1px solid #ddd;
			border-radius: 8px;
			padding: 20px;
			background: #f9f9f9;
			transition: transform 0.3s, box-shadow 0.3s;
			position: relative;
		}
		.product-card:hover {
			transform: translateY(-5px);
			box-shadow: 0 5px 15px rgba(0,0,0,0.2);
		}
		.product-title {
			font-size: 1.3em;
			font-weight: bold;
			color: #333;
			margin-bottom: 10px;
		}
		.product-info {
			margin: 8px 0;
			color: #666;
		}
		.product-price {
			font-size: 1.5em;
			color: #000000;
			font-weight: bold;
			margin-top: 10px;
		}
		.product-actions {
			margin-top: 15px;
			display: flex;
			gap: 10px;
		}
		.btn-small {
			padding: 8px 16px;
			font-size: 0.9em;
		}
		.btn-success {
			background: #000000;
			color: white;
			border: 2px solid white;
		}
		.btn-success:hover {
			background: white;
			color: black;
		}
		.pagination {
			display: flex;
			justify-content: center;
			align-items: center;
			gap: 10px;
			margin-top: 30px;
		}
		.pagination a,
		.pagination span {
			padding: 10px 15px;
			border: 1px solid #ddd;
			border-radius: 5px;
			text-decoration: none;
			color: #333;
			background: white;
		}
		.pagination a:hover {
			background: #000000;
			color: white;
		}
		.pagination .disabled {
			opacity: 0.5;
			cursor: not-allowed;
		}
		.no-products {
			text-align: center;
			padding: 40px;
			color: #999;
			font-size: 1.2em;
		}
	</style>
</head>
<body>
	<div class="container">
		<h1>Productos</h1>
		<nav class="nav">
			<a href="/">Home</a>
			<a href="/products">Productos</a>
			<a href="/realtimeproducts">Productos enTiempo Real</a>
		</nav>

		<form method="GET" action="/products" class="filters">
			<div class="filter-group">
				<label for="limit">Límite</label>
				<input type="number" id="limit" name="limit" value="{{#if limit}}{{limit}}{{else}}10{{/if}}" min="1">
			</div>
			<div class="filter-group">
				<label for="query">Filtro (categoría/disponible)</label>
				<input type="text" id="query" name="query" value="{{#if query}}{{query}}{{/if}}" placeholder="Ej: available, electronics">
			</div>
			<div class="filter-group">
				<label for="sort">Ordenar por precio</label>
				<select id="sort" name="sort">
					<option value="">Sin ordenar</option>
					<option value="asc" {{#if (eq sort 'asc')}}selected{{/if}}>Ascendente</option>
					<option value="desc" {{#if (eq sort 'desc')}}selected{{/if}}>Descendente</option>
				</select>
			</div>
			<div class="filter-group">
				<button type="submit" class="btn btn-primary">Filtrar</button>
			</div>
		</form>

		{{#if payload.length}}
			<div class="products-grid">
				{{#each payload}}
					<div class="product-card">
						<div class="product-title">{{this.title}}</div>
						<div class="product-info"><strong>Descripción:</strong> {{this.description}}</div>
						<div class="product-info"><strong>Categoría:</strong> {{this.category}}</div>
						<div class="product-info"><strong>Stock:</strong> {{this.stock}}</div>
						<div class="product-info"><strong>Estado:</strong> {{#if this.status}}Disponible{{else}}No disponible{{/if}}</div>
						<div class="product-price">${{this.price}}</div>
						<div class="product-actions">
							<a href="/products/{{this._id}}" class="btn btn-primary btn-small">Ver Detalles</a>
							<button onclick="addToCart('{{this._id}}')" class="btn btn-success btn-small">Agregar al Carrito</button>
						</div>
					</div>
				{{/each}}
			</div>

			<div class="pagination">
				{{#if hasPrevPage}}
					<a href="{{prevLink}}">Anterior</a>
				{{else}}
					<span class="disabled">Anterior</span>
				{{/if}}
				
				<span>Página {{page}} de {{totalPages}}</span>
				
				{{#if hasNextPage}}
					<a href="{{nextLink}}">Siguiente</a>
				{{else}}
					<span class="disabled">Siguiente</span>
				{{/if}}
			</div>
		{{else}}
			<div class="no-products">No hay productos disponibles</div>
		{{/if}}
	</div>

	<script>
		async function addToCart(productId) {
			// Primero crear o obtener un carrito (simplificado - en producción usarías sesión o usuario)
			try {
				// Crear un nuevo carrito o usar uno existente
				let cartId = localStorage.getItem('cartId');
				
				if (!cartId) {
					const response = await fetch('/api/carts', {
						method: 'POST'
					});
					const cart = await response.json();
					cartId = cart._id;
					localStorage.setItem('cartId', cartId);
				}

				// Agregar producto al carrito
				const addResponse = await fetch(`/api/carts/${cartId}/product/${productId}`, {
					method: 'POST'
				});

				if (addResponse.ok) {
					alert('Producto agregado al carrito');
				} else {
					alert('Error al agregar producto al carrito');
				}
			} catch (error) {
				console.error('Error:', error);
				alert('Error al agregar producto al carrito');
			}
		}
	</script>
</body>
</html>

